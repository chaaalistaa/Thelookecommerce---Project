#Revenue, Cost, Profit, and Order Trend
SELECT 
    FORMAT_TIMESTAMP('%Y', o.created_at) AS year, -- Year format
    FORMAT_TIMESTAMP('%Y-%m', o.created_at) AS year_month, -- Year and month format
    FORMAT_TIMESTAMP('%Y-%m-%d', o.created_at) AS year_month_day, -- Year, month, and day format
    SUM(oi.sale_price) AS total_revenue,
    SUM(p.cost) AS total_cost,
    SUM(oi.sale_price - p.cost) AS total_profit,
	COUNT(DISTINCT o.order_id) AS total_orders,
    ROUND(AVG(oi.sale_price - p.cost), 2) AS avg_profit_per_order
FROM 
    `bigquery-public-data.thelook_ecommerce.orders` o
JOIN 
    `bigquery-public-data.thelook_ecommerce.order_items` oi
    ON o.order_id = oi.order_id
JOIN
    `bigquery-public-data.thelook_ecommerce.products` p
    ON oi.product_id = p.id
WHERE 
    o.status = 'Complete' -- Only consider completed orders
GROUP BY 
    year, year_month, year_month_day
ORDER BY 
    year_month_day ASC;
